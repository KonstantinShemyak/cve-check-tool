/*
 * plugin.h
 *
 * Copyright (C) 2015 Intel Corporation
 *
 * cve-check-tool is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 */

#include <stdbool.h>
#include "cve-check-tool.h"

#pragma once

typedef enum {
        PLUGIN_TYPE_MIN         = 1 << 0,
        PLUGIN_TYPE_PACKAGE     = 1 << 1,       /**<Handles source packages */
        PLUGIN_TYPE_REPORT      = 1 << 2,       /**<Handles output reports */
        PLUGIN_TYPE_MAX         = 1 << 3
} CvePluginType;

struct CvePlugin;


#define _module_export_ __attribute__ ((visibility("default")))

/** Report function */
typedef bool (*cve_plugin_report_func) (CveCheckTool *db);

/** Initialisation */
typedef bool (*cve_plugin_init)         (struct CvePlugin *self);

/** Plugin teardown **/
typedef void (*cve_plugin_destroy)      (struct CvePlugin *self);

/** Encapsulate a plugin */
typedef struct CvePlugin {
        /* Plugin description */
        int flags;                           /**<Bitwise flags for this plugins support */
        const char *name;                   /**<Name of the plugin */
        void *handle;                        /**<dlopen handle */

        cve_plugin_destroy destroy;        /**<Destroy this plugin */

        /* Functions */
        cve_plugin_report_func report;    /**<Used by plugins supporting PLUGIN_OP_REPORT */
} CvePlugin;
