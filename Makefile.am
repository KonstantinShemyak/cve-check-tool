include $(top_srcdir)/common.mk

ACLOCAL_AMFLAGS = -I m4

EXTRA_DIST = ${top_srcdir}/README.md \
	     ${top_srcdir}/LICENSE \
	     ${top_srcdir}/common.mk \
	     ${top_srcdir}/tests/dummy_data/cve.ini \
	     ${top_srcdir}/tests/dummy_data/rpm/package.spec \
	     ${top_srcdir}/tests/dummy_data/rpm/packages \
	     ${top_srcdir}/tests/dummy_data/rpm/cve-2014-5461.patch \
	     ${top_srcdir}/tests/dummy_data/rpm/cve-2013-4459.nopatch \
	     ${top_srcdir}/tests/dummy_data/eopkg/pspec.xml \
	     ${top_srcdir}/tests/dummy_data/eopkg/files/security/cve-2014-5461.patch \
	     ${top_srcdir}/tests/dummy_data/eopkg/files/security/cve-2013-4459.nopatch \
	     ${top_srcdir}/tests/dummy_data/pkgbuild/PKGBUILD \
	     ${top_srcdir}/tests/dummy_data/pkgbuild/cve-2014-5461.patch

NULL =
CLEANFILES =

SUBDIRS = \
	data \
	src \
	docs

if COVERAGE
coverage:
	mkdir -p coverage
	lcov --compat-libtool --directory . --capture --output-file coverage/report
	genhtml -o coverage/ coverage/report
AM_CFLAGS += --coverage
endif


TESTS = \
	check_core \
	check_jira_plugin \
	check_packaging \
	check_template

check_PROGRAMS = \
	check_core \
	check_jira_plugin \
	check_packaging \
	check_template

check_core_SOURCES = \
	tests/check-core.c

check_core_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(AM_CFLAGS) \
	$(CHECK_CFLAGS)

check_core_LDADD = \
	$(GLIB_LIBS) \
	$(GIO_LIBS) \
	$(LIBXML2_LIBS) \
	$(CHECK_LIBS)

check_jira_plugin_SOURCES = \
	tests/check-jira-plugin.c

check_jira_plugin_CFLAGS = \
	$(check_core_CFLAGS) \
	$(LIBJSON_GLIB_CFLAGS) \
	$(LIBCURL_CFLAGS) \
	$(AM_CFLAGS) \
	$(CHECK_CFLAGS)


check_jira_plugin_LDADD = \
	$(check_core_LDADD) \
	$(LIBCURL_LIBS) \
	$(LIBJSON_GLIB_LIBS)


check_packaging_SOURCES = \
	tests/check-packaging.c

check_packaging_CFLAGS = \
	$(check_core_CFLAGS) \
	$(AM_CFLAGS) \
	$(CHECK_CFLAGS)

check_packaging_LDADD = \
	$(check_core_LDADD) \
	$(CHECK_LIBS)
check_template_SOURCES = \
	tests/check-template.c

check_template_CFLAGS = \
	$(check_core_CFLAGS) \
	$(AM_CFLAGS) \
	$(CHECK_CFLAGS)

check_template_LDADD = \
	$(check_core_LDADD) \
	$(CHECK_LIBS)

@VALGRIND_CHECK_RULES@
